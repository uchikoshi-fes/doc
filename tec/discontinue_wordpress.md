# 第43回打越祭ホームページでの WordPress 廃止について

最終更新: 2022/04/30 (土)  

## WordPress を廃止する理由

昨年度まで打越祭の HP (https://uchikoshi-fes.jp/) は WordPress というツールを使っていたが、  
今年はそれを廃止したい。  

### そもそも WordPress とは

[WordPress](//wordpress.com/) は「ワードプレス」と読み、世界中の多くの Web サイト ([約 4 割と言われている](//kinsta.com/jp/wordpress-market-share/)) に使われている  
Web サイトの簡易作成ツールである。  
プログラムを書く必要がなく Web ページを作ることができるが、その分カスタマイズ性は少し落ちてしまう。  
基本的に標準にはない機能を使いたいときはテーマやプラグインといった外部のものを使う必要がある。  

### WordPress の欠点

#### 理由１: 運用に金がかかる

WordPress 自体は無料で使うことができるが、  
仕組み上 WordPress を動かすには PHP と MySQL という物を動かせるサーバーを使う必要がある。  
これらが使えるサーバーはたいてい借りるのに費用がかかり、  
高いプランでないと動作が動くまともに使えないという事が起こりうる。  
  
実際に昨年、広報部門員 3,4 名でホームページの編集をしていたところ、  
サーバーが落ちて一時的に使用不可となる、という致命的な事例が複数回確認されたらしい。  
  
予算には限りがありできるだけ節約したいので、無料でできる方法にしたい。  

#### 理由２: 読み込みが遅い

WordPress はサイトにアクセスした際、  
サーバー側で一旦データベースにアクセスしてページの情報を取得してからページを組み立ててクライアントに送る  
という仕組みで動いているため、性能の良いサーバーを使わないと読み込みにかなり時間がかかる。  
  
現在の WordPress をさくらサーバー上で動かしている打越祭の HP は、  
ブラウザのキャッシュを消した状態でアクセスしてから読み込みが完了するまでに 10 秒以上かかる。  
これが文化祭時でサーバーにアクセスが集中していたり Wi-Fi 環境下でない場合、これ以上に時間がかかると思われる。  
  
読み込みが遅いことは非常に深刻な問題で、  
まず、 Google 検索の順位が下がってしまい、ユーザーがサイトを見つけづらかったり宣伝効果が薄れてたりしてしまう。  
また読み込み時間が少し増えるだけで多くのユーザーがサイトを離れてしまうということを Google が発表している。  
![表示速度が1秒から10秒に落ちると、直帰率は123％上昇する](https://storage.googleapis.com/twg-content/original_images/mobile-page-speed-new-industry-benchmarks-01-01-download.jpg)  
https://www.thinkwithgoogle.com/marketing-strategies/app-and-mobile/mobile-page-speed-new-industry-benchmarks/  
  
Web サイトの読み込み速度をスコアとして算出してくれる Google のサービス「Page Speed Insights」によると、  
現在の打越祭の HP はモバイルで 47 、 PC は 79 というスコアとなった。  
![モバイルでは読み込みに 14 秒かかっている](https://media.discordapp.net/attachments/944805427139465306/965746485444624455/121_20220419074902.png)  
https://pagespeed.web.dev/report?url=https%3A%2F%2Fuchikoshi-fes.jp%2F%25e6%2589%2593%25e8%25b6%258a%25e7%25a5%25ad%25e3%2581%25ab%25e9%2596%25a2%25e3%2581%2597%25e3%2581%25a6%2F&form_factor=mobile  

#### 理由３: プラグインによるセキュリティリスク

まず WordPress は世界で多く使われているツールであるため、その分攻撃の対象になりやすい。  
また WordPress を使う場合たくさんのプラグインに依存するため、それぞれのプラグインにセキュリティリスクがある。  
プラグインに脆弱性がある可能性だけでなく、プラグイン自体に悪いプログラムを仕込まれている可能性もある。  
  
対策として、セキュリティ系のプラグインを入れたり、評判の良いプラグインしか使わない、プラグインのアップデートは常に最新に保ったりなどの方法があるが、  
それでもセキュリティリスクは完全に無くせるわけではなく、またセキュリティ対策の労力が必要となる。  

## Next.js の導入

WordPress を廃止するとは言っても HTML を生で書きページを作るわけではなく、  
作業の簡易化のために [Next.js](//nextjs.org/) という Web サイトを楽に作ることのできるプログラマ向けツールを使用する。  
Next.js は JavaScript の中に HTML が埋め込まれた JSX という言語を使って記述する。  
JSX は Progate の React コースである程度練習することができるが、 JavaScript と HTML/CSS が分かればそこまで難しくはない。  

### WordPress のデメリットの克服

Next.js はリアルタイムではなくあらかじめ HTML などの Web サイトに必要なファイルを出力できる機能がある。  
このような機能のことを業界用語で Static Site Generation 、略して SSG と呼び、  
反対にリアルタイムでページを生成することを Server Side Rendering 、略して SSR と呼ぶ。  
Next.js は SSG か SSR を選択することができる。  
  
SSR はリアルタイムでの柔軟性は高いが、アクセス時に毎回サーバーでページを生成するため、  
そのようなことができるサーバーが必要でかつ性能の良いサーバーでないと Web ページの表示に時間がかかってしまう。  
SSG を使えばあらかじめページを生成するので、  
ホスティングサービスと呼ばれる Web ページをあらかじめ用意しておけばその公開だけをしてくれるサーバーを借りられるサービスを使うことができ、  
ホスティングサービスは無料で使えるものが多いのでサーバー代がかからず、  
また SSG の仕組み上速度もかなり速くセキュリティリスクも低いため、  
打越祭 HP のようなシンプルなサイトの場合は SSG が適しているので SSG を採用する。  

### その他使用するサービス / 技術

ホスティングサービスに関しては Cloudflare が運営している [Cloudflare Pages](//pages.cloudflare.com/) を使用する。  
人数制限やファイルサイズの制限など、さまざまな制限が無料でかなりゆるいためこれを採用したい。  
これは GitHub にソースコードを上げるだけで自動でサイトを生成して更新してくれる、とても便利なサービスである。  
ホームページに使う GitHub のリポジトリは [uchikoshi-fes/uchikoshi-fes.jp-2022](//github.com/uchikoshi-fes/uchikoshi-fes.jp-2022) とする。  

### 公開までの流れ

ホームページは基本的に広報部門で開発する。  
開発中はプレビュー版サイト [https://preview.uchikoshi-fes-2022.pages.dev/](//preview.uchikoshi-fes-2022.pages.dev/) のサイトが更新され、  
キリのいいところでバージョンアップを行うと本番のサイト [https://uchikoshi-fes-2022.pages.dev/](//uchikoshi-fes-2022.pages.dev/) が更新される。  
ただしこれは仮の Cloudflare が提供しているドメインなため、本番は [https://uchikoshi-fes.jp/](https://uchikoshi-fes.jp/) をカスタムドメインとして設定したい。  

### 来年度以降の引き継ぎについて

今年度のホームページはかなり高度なことをしているため、引き続きが難しいかもしれない。  
なので、できるだけ引き継ぎがしやすいように TypeScript を使わず JavaScript で開発するなどの工夫をする。  
また現在私は物理部の PC 班長であるが、物理部では今年度から JavaScript 教育に力をかけるため、物理部に引き続きをできる人材が生まれる可能性は高い。  
万が一引き続きをできる人材がいなくても、その時は (デメリットはあるものの) WordPress に戻せばいいだけなので、リスクはほぼないと思われる。  
